<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ragdoll Physics Game</title>
    <link rel="icon" href="pictures/favicon.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Link to Global Stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- Embedded CSS for Game-Specific Styles -->
    <style>
        /* Styles specific to the game page */
        main.game-page {
            padding: 0;
            margin: 0;
        }

        #game-container {
            width: 100%;
            max-width: 800px;
            height: 600px;
            margin: 0 auto;
            position: relative;
            background-color: #f4f4f4;
        }

        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Control buttons */
        .button-container {
            text-align: center;
            margin: 20px 0;
        }

        .button-container button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 18px;
        }

        .button-container button:hover {
            background-color: #b32a36;
        }

        /* Ensure the canvas doesn't overflow */
        canvas {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <!-- Consistent header -->
    <header>
        <h1>Jonathan Rothe</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About Me</a></li>
                <li><a href="resume.html">My Resume</a></li>
                <li><a href="projects.html">Projects</a></li>
            </ul>
        </nav>
    </header>

    <main class="game-page">
        <h1>Ragdoll Physics Game</h1>

        <!-- Game area -->
        <div id="game-container">
            <canvas id="game-canvas"></canvas>
        </div>

        <!-- Control buttons -->
        <div class="button-container">
            <button id="play-button">Pause</button>
            <button id="reset-button">Reset</button>
        </div>
    </main>

    <footer>
        <p>Developed by Jonathan Rothe</p>
    </footer>

    <!-- Matter.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
    <!-- Main JavaScript Code -->
    <script>
        // Module aliases
        const {
            Engine,
            Render,
            Runner,
            World,
            Bodies,
            Body,
            Constraint,
            Composite,
            Mouse,
            MouseConstraint,
            Events
        } = Matter;

        // Create engine and world
        const engine = Engine.create();
        const world = engine.world;

        // Get the dimensions of the game container
        const gameContainer = document.getElementById('game-container');
        const width = gameContainer.clientWidth;
        const height = gameContainer.clientHeight;

        // Create renderer
        const render = Render.create({
            element: gameContainer,
            canvas: document.getElementById('game-canvas'),
            engine: engine,
            options: {
                width: width,
                height: height,
                wireframes: false,
                background: '#f4f4f4',
            }
        });

        // Run the renderer
        Render.run(render);

        // Create runner
        const runner = Runner.create();
        Runner.run(runner, engine);

        // Function to create a ragdoll with realistic joint constraints
        function createRagdoll(x, y, scale) {
            scale = typeof scale === 'undefined' ? 1 : scale;

            // Body options
            const headOptions = {
                density: 0.001 * scale * scale,
                frictionAir: 0.05,
                restitution: 0.3,
                collisionFilter: { group: Body.nextGroup(true) },
                render: { fillStyle: '#FFB6C1' }
            };

            const bodyOptions = {
                density: 0.001 * scale * scale,
                frictionAir: 0.05,
                restitution: 0.3,
                collisionFilter: { group: Body.nextGroup(true) },
                render: { fillStyle: '#87CEFA' }
            };

            const limbOptions = {
                density: 0.001 * scale * scale,
                frictionAir: 0.05,
                restitution: 0.3,
                collisionFilter: { group: Body.nextGroup(true) },
                render: { fillStyle: '#FFD700' }
            };

            // Create body parts
            const head = Bodies.circle(x, y - 70 * scale, 20 * scale, headOptions);
            const chest = Bodies.rectangle(x, y, 40 * scale, 60 * scale, bodyOptions);

            const leftUpperArm = Bodies.rectangle(x - 35 * scale, y - 20 * scale, 20 * scale, 40 * scale, limbOptions);
            const leftLowerArm = Bodies.rectangle(x - 35 * scale, y + 10 * scale, 20 * scale, 40 * scale, limbOptions);

            const rightUpperArm = Bodies.rectangle(x + 35 * scale, y - 20 * scale, 20 * scale, 40 * scale, limbOptions);
            const rightLowerArm = Bodies.rectangle(x + 35 * scale, y + 10 * scale, 20 * scale, 40 * scale, limbOptions);

            const leftUpperLeg = Bodies.rectangle(x - 15 * scale, y + 50 * scale, 20 * scale, 40 * scale, limbOptions);
            const leftLowerLeg = Bodies.rectangle(x - 15 * scale, y + 80 * scale, 20 * scale, 40 * scale, limbOptions);

            const rightUpperLeg = Bodies.rectangle(x + 15 * scale, y + 50 * scale, 20 * scale, 40 * scale, limbOptions);
            const rightLowerLeg = Bodies.rectangle(x + 15 * scale, y + 80 * scale, 20 * scale, 40 * scale, limbOptions);

            // Create constraints (joints)
            const neck = Constraint.create({
                bodyA: head,
                pointA: { x: 0, y: 20 * scale },
                bodyB: chest,
                pointB: { x: 0, y: -30 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const leftShoulder = Constraint.create({
                bodyA: chest,
                pointA: { x: -20 * scale, y: -20 * scale },
                bodyB: leftUpperArm,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const leftElbow = Constraint.create({
                bodyA: leftUpperArm,
                pointA: { x: 0, y: 20 * scale },
                bodyB: leftLowerArm,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const rightShoulder = Constraint.create({
                bodyA: chest,
                pointA: { x: 20 * scale, y: -20 * scale },
                bodyB: rightUpperArm,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const rightElbow = Constraint.create({
                bodyA: rightUpperArm,
                pointA: { x: 0, y: 20 * scale },
                bodyB: rightLowerArm,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const leftHip = Constraint.create({
                bodyA: chest,
                pointA: { x: -10 * scale, y: 30 * scale },
                bodyB: leftUpperLeg,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const leftKnee = Constraint.create({
                bodyA: leftUpperLeg,
                pointA: { x: 0, y: 20 * scale },
                bodyB: leftLowerLeg,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const rightHip = Constraint.create({
                bodyA: chest,
                pointA: { x: 10 * scale, y: 30 * scale },
                bodyB: rightUpperLeg,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            const rightKnee = Constraint.create({
                bodyA: rightUpperLeg,
                pointA: { x: 0, y: 20 * scale },
                bodyB: rightLowerLeg,
                pointB: { x: 0, y: -20 * scale },
                stiffness: 0.9,
                render: { visible: false }
            });

            // Assemble the ragdoll
            const ragdoll = Composite.create({
                bodies: [
                    head,
                    chest,
                    leftUpperArm,
                    leftLowerArm,
                    rightUpperArm,
                    rightLowerArm,
                    leftUpperLeg,
                    leftLowerLeg,
                    rightUpperLeg,
                    rightLowerLeg
                ],
                constraints: [
                    neck,
                    leftShoulder,
                    leftElbow,
                    rightShoulder,
                    rightElbow,
                    leftHip,
                    leftKnee,
                    rightHip,
                    rightKnee
                ]
            });

            // Store references for joint angle limits
            ragdoll.partsMap = {
                head,
                chest,
                leftUpperArm,
                leftLowerArm,
                rightUpperArm,
                rightLowerArm,
                leftUpperLeg,
                leftLowerLeg,
                rightUpperLeg,
                rightLowerLeg
            };

            return ragdoll;
        }

        // Create ground
        const ground = Bodies.rectangle(width / 2, height - 10, width, 20, {
            isStatic: true,
            friction: 1.0,
            render: { fillStyle: '#2E8B57' }
        });

        // Create walls
        const wallLeft = Bodies.rectangle(-10, height / 2, 20, height, {
            isStatic: true,
            render: { visible: false }
        });
        const wallRight = Bodies.rectangle(width + 10, height / 2, 20, height, {
            isStatic: true,
            render: { visible: false }
        });

        // Add objects to the world
        World.add(world, [ground, wallLeft, wallRight]);

        // Create boxes
        for (let i = 0; i < 10; i++) {
            const box = Bodies.rectangle(
                Math.random() * width,
                Math.random() * (height / 2),
                40,
                40,
                {
                    render: { fillStyle: '#D2691E' },
                    friction: 0.5
                }
            );
            World.add(world, box);
        }

        // Create and add the ragdoll
        let ragdoll = createRagdoll(width / 2, height / 2 - 100, 1);
        World.add(world, ragdoll);

        // Mouse control
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: { visible: false },
            }
        });
        World.add(world, mouseConstraint);
        render.mouse = mouse;

        // Function to limit joint rotation
        function limitRotation(bodyA, bodyB, minAngle, maxAngle) {
            const angle = bodyA.angle - bodyB.angle;
            if (angle < minAngle) {
                Body.setAngle(bodyA, bodyB.angle + minAngle);
                Body.setAngularVelocity(bodyA, 0);
            } else if (angle > maxAngle) {
                Body.setAngle(bodyA, bodyB.angle + maxAngle);
                Body.setAngularVelocity(bodyA, 0);
            }
        }

        // Limit joint angles for realistic movement
        Events.on(engine, 'beforeUpdate', function(event) {
            const {
                head,
                chest,
                leftUpperArm,
                leftLowerArm,
                rightUpperArm,
                rightLowerArm,
                leftUpperLeg,
                leftLowerLeg,
                rightUpperLeg,
                rightLowerLeg
            } = ragdoll.partsMap;

            // Head rotation limit (±30 degrees)
            limitRotation(head, chest, -Math.PI / 6, Math.PI / 6);

            // Left shoulder rotation limit (±90 degrees)
            limitRotation(leftUpperArm, chest, -Math.PI / 2, Math.PI / 2);
            // Left elbow rotation limit (0 to 150 degrees)
            limitRotation(leftLowerArm, leftUpperArm, 0, (5 * Math.PI) / 6);

            // Right shoulder rotation limit (±90 degrees)
            limitRotation(rightUpperArm, chest, -Math.PI / 2, Math.PI / 2);
            // Right elbow rotation limit (0 to 150 degrees)
            limitRotation(rightLowerArm, rightUpperArm, 0, (5 * Math.PI) / 6);

            // Left hip rotation limit (-30 to 90 degrees)
            limitRotation(leftUpperLeg, chest, -Math.PI / 6, Math.PI / 2);
            // Left knee rotation limit (0 to 150 degrees)
            limitRotation(leftLowerLeg, leftUpperLeg, 0, (5 * Math.PI) / 6);

            // Right hip rotation limit (-30 to 90 degrees)
            limitRotation(rightUpperLeg, chest, -Math.PI / 6, Math.PI / 2);
            // Right knee rotation limit (0 to 150 degrees)
            limitRotation(rightLowerLeg, rightUpperLeg, 0, (5 * Math.PI) / 6);
        });

        // Control buttons
        const playButton = document.getElementById('play-button');
        const resetButton = document.getElementById('reset-button');
        let isRunning = true;

        playButton.addEventListener('click', () => {
            if (isRunning) {
                Runner.stop(runner);
                playButton.textContent = 'Play';
                isRunning = false;
            } else {
                Runner.run(runner, engine);
                playButton.textContent = 'Pause';
                isRunning = true;
            }
        });

        resetButton.addEventListener('click', () => {
            // Clear the world except static bodies
            World.clear(world, false);

            // Add ground and walls back
            World.add(world, [ground, wallLeft, wallRight]);

            // Add boxes
            for (let i = 0; i < 10; i++) {
                const box = Bodies.rectangle(
                    Math.random() * width,
                    Math.random() * (height / 2),
                    40,
                    40,
                    {
                        render: { fillStyle: '#D2691E' },
                        friction: 0.5
                    }
                );
                World.add(world, box);
            }

            // Create and add ragdoll
            ragdoll = createRagdoll(width / 2, height / 2 - 100, 1);
            World.add(world, ragdoll);

            // Restart the runner if it was stopped
            if (!isRunning) {
                Runner.run(runner, engine);
                isRunning = true;
                playButton.textContent = 'Pause';
            }
        });
    </script>
</body>
</html>
